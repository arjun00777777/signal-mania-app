<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<title>Whale Intel</title>

<style>
:root{
--bg:#0f172a;
--card:#111827;
--blue:#3b82f6;
--green:#22c55e;
--red:#ef4444;
--gold:#facc15;
--text:#f8fafc;
--muted:#94a3b8;
}

body{
margin:0;
font-family:system-ui;
background:linear-gradient(180deg,#020617,#0f172a);
color:var(--text);
padding-bottom:80px;
}

.app{max-width:520px;margin:auto;padding:14px}

.card{
background:linear-gradient(145deg,#020617,#111827);
border-radius:18px;
padding:16px;
margin-bottom:14px;
border:1px solid rgba(255,255,255,.1);
}

h2{margin:0 0 6px;font-size:18px}
p{margin:6px 0;font-size:13px;color:#cbd5e1}

.tab{display:none}
.tab.active{display:block}

.signal{
background:#020617;
border-radius:14px;
padding:14px;
margin-bottom:12px;
border:1px solid rgba(255,255,255,.08);
}

.signal .hidden{display:none}
.signal.open .hidden{display:block}

.blur{
filter:blur(6px);
opacity:.6;
padding:2px 6px;
background:rgba(255,255,255,.12);
border-radius:6px;
}

.badge{
background:linear-gradient(90deg,#facc15,#f59e0b);
color:#000;
font-size:11px;
padding:3px 8px;
border-radius:999px;
font-weight:700;
}

.nav{
position:fixed;
bottom:0;left:0;right:0;
display:flex;
justify-content:space-around;
background:#020617;
padding:10px 0;
border-top:1px solid rgba(255,255,255,.1);
}

.nav-item{
font-size:11px;
color:var(--muted);
text-align:center;
}

.nav-item.active{color:var(--blue)}
</style>
</head>

<body>

<div class="app">

<!-- HOME -->
<div id="home" class="tab active">
<div class="card">
<h2 id="username">Trader</h2>
<p>User ID: <span id="uid">â€”</span></p>
</div>

<div class="card">
<h2>ğŸ Referrals</h2>
<p><b id="refCount">0</b> / 5 completed</p>
<p>Invite friends â†’ unlock PRO</p>
</div>
</div>

<!-- SIGNALS -->
<div id="signals" class="tab">
<div class="card">
<h2>ğŸ“¡ Signals <span class="badge">PRO</span></h2>

<div class="signal" onclick="toggle(this)">
<b>BTC / USDT</b>
<p>Whale activity detected</p>
<div class="hidden">
<p>Entry: <span class="blur">$66,800</span></p>
<p>Target: <span class="blur">$69,400</span></p>
<p style="color:var(--gold)">ğŸ”’ PRO required</p>
</div>
</div>

</div>
</div>

</div>

<!-- NAV -->
<div class="nav">
<div class="nav-item active" onclick="openTab('home',this)">ğŸ <br>Home</div>
<div class="nav-item" onclick="openTab('signals',this)">ğŸ“¡<br>Signals</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();
tg.ready();

let user = tg.initDataUnsafe?.user || null;
let isPremium = false;

if(user){
document.getElementById("username").innerText = user.first_name;
document.getElementById("uid").innerText = user.id;
loadReferralStats();
checkPremium();
}

async function checkPremium(){
const r = await fetch("http://127.0.0.1:5000/user/status",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({uid:user.id})
});
const d = await r.json();
isPremium = d.premium;
}

async function loadReferralStats(){
const r = await fetch("http://127.0.0.1:5000/user/referrals",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({uid:user.id})
});
const d = await r.json();
document.getElementById("refCount").innerText = d.referrals;
}

function openTab(id,el){
document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
document.getElementById(id).classList.add("active");
document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
el.classList.add("active");

if(id==="signals" && !isPremium){
tg.showPopup({
title:"ğŸ”’ PRO Required",
message:"Invite 5 friends or upgrade to unlock signals",
buttons:[{type:"ok"}]
});
}
}

function toggle(el){el.classList.toggle("open")}
</script>

</body>
</html>
